<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Human Rights Festival 2025</title>
    <style>
      :root {
        --bg: #0f1724; /* page background */
        --card: #0b1220; /* screen surface */
        --accent: #f15f5fe7; /* active color */
        --muted: #5a5c60; /* inactive color */
        --nav-bg: rgba(255, 255, 255, 0.03);
        --radius: 14px;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
      }
      html,
      body {
        height: 96%;
      }
      body {
        margin: 0;
        background: linear-gradient(180deg, var(--bg), #13273e);
        color: #07101a;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* App frame */
      .phone {
        width: 400px; /* desktop preview width; it'll scale on mobile */
        max-width: 100%;
        height: 780px;
        max-height: 100vh;
        background: url("human-rights-bg.png") no-repeat center center;
        background-size: cover;
        border-radius: 30px;
        box-shadow: 0 20px 40px rgba(2, 6, 23, 0.6),
          0 4px 10px rgba(0, 0, 0, 0.6) inset;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Top bar (status) ‚Äî mobile safe and consistent */
      .status {
        height: calc(44px + env(safe-area-inset-top, 0px));
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: env(safe-area-inset-top, 0px) 12px 0 12px;
        font-size: 13px;
        color: var(--muted);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          transparent
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.02);
        box-sizing: border-box;
      }

      /* Content area */
      .content {
        position: relative;
        flex: 1 1 auto;
        display: block;
        padding: 18px;
        padding-bottom: 90px; /* prevent content from being hidden under tabbar */
        overflow-x: hidden;
        overflow-y: auto;
        background: transparent;
        scroll-behavior: smooth;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      .content::-webkit-scrollbar {
        display: none;
      }

      /* Make each screen auto-sized instead of stretching */
      .screen {
        display: block;
        height: auto;
        min-height: fit-content;
        padding-bottom: 45px;
      }

      .screen.active {
        transform: none;
        opacity: 1;
        pointer-events: auto;
      }

      /* Optional: only the active screen is shown */
      .screen:not(.active) {
        display: none;
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 1),
          rgba(255, 255, 255, 0.01)
        );
        max-width: 95%;
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 12px;
        box-shadow: 0 6px 18px rgba(2, 6, 23, 0.45);
      }

      h1 {
        margin: 0 0 8px;
        font-size: 24px;
        font-weight: 800;
        color: var(--accent);
      }
      h3 {
        margin: 0 0 8px;
        font-size: 18px;
        font-weight: 600;
      }
      p {
        margin: 0;
        color: var(--muted);
        line-height: 1.5;
      }
      a {
        margin: 0;
        color: var(--muted);
        line-height: 1.5;
      }

      a:hover {
        color: #aaa; /* slightly lighter on hover */
      }

      /* Bottom tab bar */
      .tabbar {
        position: absolute; /* fixed inside the phone frame */
        bottom: 0;
        left: 0;
        right: 0;
        height: 34px;
        background: var(--nav-bg);
        border-top: 1px solid rgba(255, 255, 255, 0.03);
        border-radius: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px 50px;
        z-index: 10;
      }

      .tab {
        border: none;
        background: transparent;
        padding: 0;
        margin: 0;
        cursor: pointer;
        display: flex;
        justify-content: center; /* center horizontally */
        align-items: center; /* center vertically */
        flex: 1 1 auto;
        height: 100%;
      }

      .tab:focus {
        outline: none;
      }

      .tab-icon {
        display: block;
        width: 80%;
        height: auto;
        object-fit: contain;
      }

      /* Optional active highlight */
      .tab .tab-icon {
        filter: opacity(0.5);
        transition: transform 0.25s ease, opacity 0.25s ease;
      }

      .tab.active .tab-icon {
        filter: opacity(0.9);
        transform: scale(1.2); /* increase size of active icon */
      }

      /* badge example */
      .badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        background: rgba(255, 255, 255, 0.04);
        color: var(--muted);
      }

      /* Responsive: make phone narrower on small screens */
      @media (max-width: 100%) {
        .phone {
          width: 100%;
          height: 100vh;
          border-radius: 0;
        }
        .tabbar {
          left: 0;
          right: 0;
          bottom: 0;
          border-radius: 0;
          height: 70px;
          padding: 10px;
        }
        .screen {
          padding: 20px 0px 96px;
        }
      }

      /* --- NEW GAME CSS --- */
      #game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        height: 100%; /* Try to fill the screen */
        justify-content: space-around;
      }

      #wheel-container {
        position: relative;
        width: 200px;
        height: 200px;
        margin: 20px auto;
        display: none; /* Initially hidden */
      }

      #wheel {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-image: conic-gradient(
          #e53e3e 0deg 90deg,
          #38a169 90deg 180deg,
          #3182ce 180deg 270deg,
          #d69e2e 270deg 360deg
        );
        /* Animation will be controlled by JS */
        border: 8px solid #07101a;
        box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(3600deg); /* 10 full spins */
        }
      }

      #quiz-section {
        width: 100%;
        margin-top: 20px;
        text-align: left;
      }

      .choice-btn {
        width: 100%;
        padding: 12px;
        margin: 6px 0;
        border: 0px solid var(--accent);
        background-image: var(--bg);
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center center;
        color: rgba(0, 0, 0, 0.95);
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s;
        text-align: left;
      }
      .choice-btn:hover:not(:disabled) {
        .choice-btn {
          width: 100%;
          padding: 12px;
          margin: 6px 0;
          border: 1px solid var(--accent);
          background: white;
          color: rgba(0, 0, 0, 0.95);
          border-radius: 8px;
          cursor: pointer;
          font-size: 14px;
          transition: background 0.2s;
          text-align: left;
        }
      }
      .choice-btn:disabled {
        opacity: 1; /* Keep opacity for visibility */
      }

      .correct-answer {
        background-color: rgba(
          52,
          211,
          153,
          0.4
        ) !important; /* Green for correct */
        border-color: #34d399 !important;
      }
      .wrong-answer {
        background-color: rgba(
          239,
          68,
          68,
          0.4
        ) !important; /* Red for incorrect click */
        border-color: #ef4444 !important;
      }

      /* Redefine refresh-btn as the main game button */
      .game-btn {
        position: relative; /* Not sticky anymore */
        bottom: auto;
        left: auto;
        right: auto;
        z-index: 100;
        padding: 12px 18px;
        border: none;
        border-radius: 14px;
        background: url("collage_button.png") no-repeat center center;
        background-size: cover;
        color: rgba(0, 0, 0, 0.8);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.25s ease;
        margin-top: 20px;
        width: 100%;
        max-width: 300px;
      }
      .game-btn:hover:not(:disabled) {
        background: url("collage_button.png") no-repeat center center;
        background-size: cover;
        color: rgba(0, 0, 0, 0.95);
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }
      .game-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
    </style>
  </head>

  <body>
    <div
      class="phone"
      role="application"
      aria-label="Human Rights Festival 2025"
    >
      <main class="content">
        <section
          id="vendors"
          class="screen active"
          role="region"
          aria-label="Human Rights Quiz"
        >
          <div id="game-container">
            <img
              src="title.png"
              style="
                position: absolute;
                top: 50px;
                left: 50%;
                transform: translateX(-50%);
                height: 200px;
                z-index: 0;
              "
            />
            <div style="height: 160px"></div>
            <h3
              style="z-index: 10; color: darkolivegreen"
              id="spins-score-info"
            >
              Rounds Left: 10 | Score: 0
            </h3>

            <h1 id="game-info" style="z-index: 10"> </h1>
            <div id="wheel-container">
              <div id="wheel"></div>
            </div>

            <div id="quiz-section" style="display: none">
              <h3 id="question-text" style="color: var(--accent)"></h3>
              <div id="choices-container"></div>
            </div>

            <button id="spin-btn" class="game-btn">Spin Wheel (10 left)</button>
            <button id="play-again-btn" class="game-btn" style="display: none">
              Play Again!
            </button>
          </div>
        </section>

        <section
          id="about"
          class="screen"
          role="region"
          aria-label="about screen"
        >
          <div style="height: 70px">
          </div>
          <div style="text-align: center">
            <h1>About Us</h1>
          </div>
          <img
            src="hrf_sticker.jpg"
            alt="Human Rights Festival Logo"
            style="
              width: 80%;
              max-width: 100%;
              display: block;
              margin: 0 auto 12px auto;
            "
          />
          <div class="card" style="text-align: center">
            <h3
              style="
                margin: 0;
                font-size: 1.1rem;
                font-weight: 600;
                background: linear-gradient(
                  90deg,
                  #fa7e1e,
                  #d62976,
                  #962fbf,
                  #4f5bd5
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
              "
            >
              Official Instagram Account
            </h3>
            <p style="margin: 8px 0 0 0">
              <a
                href="https://www.instagram.com/bc.hrc/"
                target="_blank"
                style="
                  color: white;
                  text-decoration: none;
                  background: linear-gradient(90deg, #fa7e1e, #d62976);
                  padding: 6px 12px;
                  border-radius: 10px;
                  display: inline-block;
                "
              >
                @bc.hrc
              </a>
            </p>
          </div>
        </section>
      </main>

      <nav class="tabbar" role="tablist" aria-label="Bottom tabs">
        <button
          class="tab active"
          role="tab"
          aria-selected="true"
          aria-controls="vendors"
          data-target="vendors"
          id="tab-vendors"
        >
          <img src="quiz.png" alt="Quiz" class="tab-icon" />
        </button>

        <button
          class="tab"
          role="tab"
          aria-selected="false"
          aria-controls="about"
          data-target="about"
          id="tab-about"
        >
          <img src="about.png" alt="About" class="tab-icon" />
        </button>
      </nav>

      <script>
        // Tab switching logic with URL hash support + accessibility
        (function () {
          const tabs = document.querySelectorAll(".tab");
          const screens = document.querySelectorAll(".screen");

          function activate(targetId, pushState = true) {
            // toggle tab active states
            tabs.forEach((t) => {
              const is = t.dataset.target === targetId;
              t.classList.toggle("active", is);
              t.setAttribute("aria-selected", is ? "true" : "false");
            });
            // toggle screens
            screens.forEach((s) => {
              s.classList.toggle("active", s.id === targetId);
            });

            if (pushState) {
              history.replaceState(null, "", "#" + targetId);
            }
          }

          // attach events
          tabs.forEach((t) => {
            t.addEventListener("click", () => activate(t.dataset.target));
            t.addEventListener("keydown", (e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                activate(t.dataset.target);
              }
            });
          });

          // on load, open from hash if present
          const initial = location.hash
            ? location.hash.replace("#", "")
            : "vendors";
          if (document.getElementById(initial)) activate(initial, false);

          // handle back/forward
          window.addEventListener("hashchange", () => {
            const h = location.hash.replace("#", "") || "vendors";
            if (document.getElementById(h)) activate(h, false);
          });

          // always scroll to top when switching screens
          const realActivate = activate;
          activate = function (target) {
            // deactivate current screen
            const cur = document.querySelector(".screen.active");
            if (cur) cur.classList.remove("active");

            // activate target screen
            realActivate(target);

            // scroll to top of the content area or screen
            const opened = document.getElementById(target);
            if (opened)
              opened.scrollTo({
                top: 0,
                behavior: "smooth",
              });
          };
        })();
      </script>
    </div>
  </body>
  <script>
    // --- NEW: Color Definitions ---
    const choicebg = [
      "peach.png", // Mint Green / Soft Aqua
      "cement.png", // Light Yellow / Pale Gold
      "olive.png", // Light Lilac / Soft Lavender
      "cyan.png", // Light Pink / Pastel Rose
    ];
    // --- END Color Definitions ---

    // --- Helper functions for cookie handling ---
    function setCookie(name, value, days) {
      const d = new Date();
      d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
      const expires = "expires=" + d.toUTCString();
      document.cookie =
        name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/";
    }

    function getCookie(name) {
      const decoded = decodeURIComponent(document.cookie);
      const parts = decoded.split("; ");
      for (let part of parts) {
        if (part.startsWith(name + "=")) {
          return part.substring(name.length + 1);
        }
      }
      return null;
    }

    function deleteCookie(name) {
      document.cookie =
        name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }
    // --- END Cookie Helpers ---

    // --- FULLY CUSTOMIZABLE QUIZ DATA ---
    // The game will randomly select from this list, ensuring no ID is repeated.
    const quizData = [
      {
        id: 1,
        question: "Question 1",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 2,
        question: "Question 2",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 3,
        question: "Question 3",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 4,
        question: "Question 4",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 5,
        question: "Question 5",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 6,
        question: "Question 6",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 7,
        question: "Question 7",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 8,
        question: "Question 8",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 9,
        question: "Question 9",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 10,
        question: "Question 10",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 11,
        question: "Question 11",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 12,
        question: "Question 12",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 13,
        question: "Question 13",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 14,
        question: "Question 14",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 15,
        question: "Question 15",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 16,
        question: "Question 16",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 17,
        question: "Question 17",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 18,
        question: "Question 18",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 19,
        question: "Question 19",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
      {
        id: 20,
        question: "Question 20",
        correct: "Correct Answer",
        incorrect: [
          "Incorrect Answer 1",
          "Incorrect Answer 2",
          "Incorrect Answer 3",
        ],
        context:
          "Explanation lorem ipsum dolor sit amet. For more context for the players.",
      },
    ];

    // --- GAME LOGIC ---
    let score = 0;
    const maxSpins = 4;
    let spinsLeft = maxSpins;
    let usedQuizIds = new Set();
    let currentCorrectAnswer = "";
    let isSpinning = false;
    let quizAnswered = false; // Flag: true if the current question has been answered
    let pendingQuizId = null; // ID of the quiz currently displayed, but not yet answered

    const gameInfoEl = document.getElementById("game-info");
    const spinsScoreInfoEl = document.getElementById("spins-score-info");
    const wheelContainerEl = document.getElementById("wheel-container");
    const wheelEl = document.getElementById("wheel");
    const quizSectionEl = document.getElementById("quiz-section");
    const questionTextEl = document.getElementById("question-text");
    const choicesContainerEl = document.getElementById("choices-container");
    const spinBtnEl = document.getElementById("spin-btn");
    const playAgainBtnEl = document.getElementById("play-again-btn");

    function saveGame() {
      const gameState = {
        score: score,
        spinsLeft: spinsLeft,
        usedQuizIds: Array.from(usedQuizIds),
        pendingQuizId: pendingQuizId,
        quizAnswered: quizAnswered,
      };
      setCookie("hrfQuizState", JSON.stringify(gameState), 30); // Save for 30 days
    }

    function resetGame() {
      score = 0;
      spinsLeft = maxSpins;
      usedQuizIds = new Set();
      pendingQuizId = null;
      quizAnswered = false;

      deleteCookie("hrfQuizState");

      // Reset UI elements to starting state
      gameInfoEl.textContent = " ";

      // Ensure buttons are visible/hidden correctly before calling updateInfo
      spinBtnEl.style.display = "block";
      playAgainBtnEl.style.display = "none";

      resetQuizUI(); // Ensures score/spin info is updated and quiz section is hidden
    }

    function updateInfo() {
      if (spinsLeft > 0) spinsScoreInfoEl.textContent = `Rounds Left: ${spinsLeft} | Score: ${score}`;

      if (quizAnswered && spinsLeft === 0) {
        // Button re-enabled after answer is selected
        spinBtnEl.textContent = `End Game`;
      } else if (quizAnswered && spinsLeft > 0) {
        // Button re-enabled after answer is selected
        spinBtnEl.textContent = `Spin Wheel (${spinsLeft} left)`;
      } else if (!quizAnswered && quizSectionEl.style.display !== "none") {
        // Button disabled when quiz is visible and not answered
        spinBtnEl.textContent = "Answer the question first";
      } else {
        // Default state before first spin or after spin finished/UI reset
        spinBtnEl.textContent = `Spin Wheel (${spinsLeft} left)`;
      }

      // Main button control: disable if spinning, or if quiz is active and not answered, or if game is over (and 'play again' is now visible)
      const shouldSpinBtnBeDisabled =
        isSpinning ||
        (!quizAnswered && quizSectionEl.style.display !== "none") ||
        (spinsLeft === 0 && !quizAnswered);
      spinBtnEl.disabled = shouldSpinBtnBeDisabled;
    }

    function getRandomUniqueQuiz() {
      const availableQuizzes = quizData.filter(
        (quiz) => !usedQuizIds.has(quiz.id)
      );
      if (availableQuizzes.length === 0) return null;

      const idx = Math.floor(Math.random() * availableQuizzes.length);
      return availableQuizzes[idx];
    }

    function displayQuiz(quiz) {
      quizAnswered = false;
      quizSectionEl.style.display = "block";

      // Ensure the displayed quiz ID is saved as pending
      pendingQuizId = quiz.id;
      saveGame();

      questionTextEl.innerHTML = quiz.question; // Use innerHTML to allow HTML in the question string

      currentCorrectAnswer = quiz.correct;
      const context = quiz.context; // Store context for reveal

      // Combine correct and incorrect options
      const options = [quiz.correct, ...quiz.incorrect].sort();

      choicesContainerEl.innerHTML = "";
      options.forEach((option, index) => {
        const button = document.createElement("button");
        button.className = "choice-btn";
        button.textContent = option;
        // üëá UPDATED: Assign bg based on the index (0, 1, 2, 3) üëá
        const sequentialbg = choicebg[index];
        button.style.setProperty("--bg", `url('${sequentialbg}')`);
        // üëÜ END UPDATED üëÜ
        button.onclick = () => checkAnswer(option, button, context);
        choicesContainerEl.appendChild(button);
      });

      updateInfo(); // Button will disable here
    }

    function checkAnswer(selectedAnswer, clickedButton, context) {
      quizAnswered = true;
      const isCorrect = selectedAnswer === currentCorrectAnswer;
      const allButtons = choicesContainerEl.querySelectorAll(".choice-btn");

      // Disable all buttons and highlight results
      allButtons.forEach((btn) => {
        btn.disabled = true;
        if (btn.textContent === currentCorrectAnswer) {
          btn.classList.add("correct-answer");
        } else if (btn === clickedButton && !isCorrect) {
          btn.classList.add("wrong-answer");
        }
      });

      if (isCorrect) {
        score++;
        questionTextEl.innerHTML = `‚úÖ Correct!<br>${context}`;
      } else {
        questionTextEl.innerHTML = `‚ùå Incorrect!<br>${context}`;
      }

      // After successfully answering, clear the pending question ID
      pendingQuizId = null;

      saveGame(); // SAVE NEW SCORE/STATE
      updateInfo(); // Button will re-enable here as 'Next Advocate'
    }

    function resetQuizUI() {
      quizAnswered = false;
      quizSectionEl.style.display = "none";
      choicesContainerEl.innerHTML = "";

      // Final screen when 10 spins are done
      if (spinsLeft === 0) {
        spinBtnEl.style.display = "none";
        playAgainBtnEl.style.display = "block"; // Show play again button

        spinsScoreInfoEl.textContent = `Game Over! Final Score: ${score}/${maxSpins}`;
      } else {
        spinBtnEl.style.display = "block";
        playAgainBtnEl.style.display = "none"; // Hide play again button
      }

      updateInfo();
    }

    function spinWheel() {
      // Logic for moving to the next round (only allowed if answered or first spin)
      if (quizAnswered || quizSectionEl.style.display === "none") {
        if (spinsLeft === 0) {
          resetQuizUI(); // Game over sequence
          return;
        }
        // Reset UI for the next spin immediately
        resetQuizUI();
      } else {
        // This case should be prevented by the disabled button, but as a guard:
        return;
      }

      // Spinning logic
      isSpinning = true;

      const quiz = getRandomUniqueQuiz();
      if (!quiz) {
        gameInfoEl.textContent = "All advocates discovered!";
        spinBtnEl.disabled = true;
        return;
      }

      spinsLeft--; // Spin count decrements only when a spin successfully starts
      usedQuizIds.add(quiz.id);
      // We rely on displayQuiz to set pendingQuizId and save the state before displaying the question

      // Hide quiz, show wheel
      wheelContainerEl.style.display = "block";
      spinBtnEl.disabled = true;

      // Animate the wheel (just visual flair)
      wheelEl.style.transition = "none";
      wheelEl.style.transform = "rotate(0deg)";
      // Force repaint
      wheelEl.offsetHeight;
      wheelEl.style.transition = "transform 3s ease-out";
      // Spin between 10 to 12 rotations for decoration
      const finalRotation =
        360 * (10 + Math.random() * 2) + Math.random() * 360;
      wheelEl.style.transform = `rotate(${finalRotation}deg)`;

      // After animation, hide wheel and show quiz
      setTimeout(() => {
        wheelContainerEl.style.display = "none";
        isSpinning = false; // Spinning finished
        displayQuiz(quiz);
      }, 3000); // Animation duration
    }

    function initGame() {
      // 1. Load game state from cookie
      const savedState = getCookie("hrfQuizState");
      if (savedState) {
        try {
          const gameState = JSON.parse(savedState);
          score = "score" in gameState ? gameState.score : 0;
          spinsLeft = "spinsLeft" in gameState ? gameState.spinsLeft : maxSpins;

          usedQuizIds = new Set(gameState.usedQuizIds || []);
          pendingQuizId = gameState.pendingQuizId || null;
          quizAnswered = gameState.quizAnswered || false;

          if (spinsLeft === 0) {
            quizAnswered = true; // Ensure game over UI if finished
          }
        } catch (e) {
          console.error("Error loading game state:", e);
        }
      }

      // 2. RESTORE PENDING QUIZ if one exists and hasn't been answered
      if (pendingQuizId !== null && !quizAnswered) {
        const pendingQuiz = quizData.find((q) => q.id === pendingQuizId);
        if (pendingQuiz) {
          // Restore the quiz display.
          displayQuiz(pendingQuiz);
        }
      }

      // 3. If the game is over on load, trigger the game over UI
      if (spinsLeft === 0) {
        resetQuizUI();
      }

      // 4. Set up event listener and update UI
      updateInfo();
      spinBtnEl.addEventListener("click", spinWheel);
      playAgainBtnEl.addEventListener("click", resetGame);
    }

    // Run game initialization once DOM is loaded
    window.addEventListener("DOMContentLoaded", initGame);
  </script>
</html>
